---
title: "Title: "
format: html
---

Authors: Isabella C. Richmond^1^\*, Kayleigh Hutt-Taylor^1,2^, Lauren Bianco^1^, Antonia Vieira Zanella^3^, François Bérubé^4^, Paola Faddoul^4^, Kelly Vu^4^, Étienne Perreault-Mandeville^5^, Patrick Boivin^6^, Danielle Dagenais^6^, Nathalie Boucher^5^, Thi Thanh Hiên Pham^4^, Carly D. Ziter^1^

1 Department of Biology, Concordia University, Montreal Canada, H4B 1R6

2 Tree Canada

3 Department of Geography, Federal University of Paraná, Paraná Brazil,

4 Département d'études urbaines et touristiques, Université du Québec à Montréal, Montreal Canada,

5 Organisme Respire

6 École d'urbanisme et d'architecture de paysage, Université de Montréal, Montreal Canada

\* isabella.richmond\@mail.concordia.ca

```{r, echo=FALSE, eval=TRUE, warning=FALSE, message=FALSE}
source('R/packages.R')

tar_load(prior_model_list)


plot_prior <- function(mod, xmin, xmax, ylab){
  
  # how to sequence data
  seq_d <- seq(xmin, xmax, by = 0.5)
  
  # pull variables from model 
  vars <- colnames(mod$data)[-1]
  
  # identify categorical variables 
  factors <- names(Filter(is.factor,mod$data[-1]))
  
  # identify numeric variables 
  numeric <- names(Filter(is.numeric,mod$data[-1]))
  
  figlist <- lapply(numeric, function(x){
    
    df <- data.frame(matrix(ncol=length(vars),nrow=0, dimnames=list(NULL, vars)))
    
    df %<>%
      summarise_at(x, ~seq_d) %>%
      bind_rows(df, .) %>%
      mutate(across(all_of(factors), as.factor)) %>% 
      mutate(across(all_of(numeric), ~ replace(., is.na(.), 0)))
    
    epred <- add_epred_draws(df, mod)
    
    ggplot(epred, aes(x = get(x), y = .epred)) +
      geom_line(aes(group = .draw), alpha = 0.1) +
      labs(y = ylab, x = x) +
      theme_classic()
    
  })
}
```

## Prior Predictive Checks

Prior predictive checks are used to ensure that the values selected for priors for our models allow a biologically reasonable range of values. For numeric predictor variables, we simulate predictive draws for prior only models and visualize the slope/intercept of the values. We then do a "posterior predictive check" but with the prior only model, to see if the data is captured in the priors. Note that all data is scaled and centered in these data.

For Trois-Rivieres, there is only a categorical predictor variable. Therefore, only the posterior predictive check is presented.

## Model 1a: Canopy cover in Villeray-Saint Michel-Parc Extension (VSMPE)
```{r, echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
mod <- prior_model_list['canopy_vsmpe_prior']
figs <- plot_prior(mod[[1]], -3, 3, 'Predicted Canopy Cover (%)')
do.call(grid.arrange, figs)
plot(pp_check(mod[[1]], ndraws = 100))
```


## Model 1b: Canopy cover in Trois-Rivieres (TR)
```{r, echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
mod <- prior_model_list['canopy_tr_prior']
plot(pp_check(mod[[1]], ndraws = 100))
```

## Model 2: Firefly presence in VSMPE 
```{r, echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
mod <- prior_model_list['fireflies_vsmpe_prior']
figs <- plot_prior(mod[[1]], -3, 3, 'Predicted Firefly Presence')
do.call(grid.arrange, figs)
plot(pp_check(mod[[1]], ndraws = 100))
```

## Model 3a: Species richness in VSMPE 
```{r, echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
mod <- prior_model_list['sr_vsmpe_prior']
figs <- plot_prior(mod[[1]], -3, 3, 'Predicted Tree Species Richness')
do.call(grid.arrange, figs)
plot(pp_check(mod[[1]], ndraws = 1000))
```

## Model 3b: Species richness in TR 
```{r, echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
mod <- prior_model_list['sr_tr_prior']
plot(pp_check(mod[[1]], ndraws = 1000))
```

## Model 4a: Functional richness in VSMPE 
```{r, echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
mod <- prior_model_list['fg_vsmpe_prior']
figs <- plot_prior(mod[[1]], -3, 3, 'Predicted Tree Functional Diversity')
do.call(grid.arrange, figs)
plot(pp_check(mod[[1]], ndraws = 1000))
```

## Model 4b: Functional richness in TR 
```{r, echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
mod <- prior_model_list['fg_tr_prior']
plot(pp_check(mod[[1]], ndraws = 1000))
```

## Model 5a: Vegetative complexity in VSMPE 
```{r, echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
mod <- prior_model_list['vc_vsmpe_prior']
figs <- plot_prior(mod[[1]], -3, 3, 'Predicted Vegetative Complexity')
do.call(grid.arrange, figs)
plot(pp_check(mod[[1]], ndraws = 1000))
```

## Model 5b: Vegetative complexity in TR 
```{r, echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
mod <- prior_model_list['vc_tr_prior']
plot(pp_check(mod[[1]], ndraws = 1000))
```

## Model 6a: Proportion native trees in VSMPE 
```{r, echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
mod <- prior_model_list['pn_vsmpe_prior']
figs <- plot_prior(mod[[1]], -3, 3, 'Predicted Proportion Native Stems')
do.call(grid.arrange, figs)
plot(pp_check(mod[[1]], ndraws = 100))
```

## Model 6b: Proportion native trees in TR 
```{r, echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
mod <- prior_model_list['pn_vsmpe_prior']
plot(pp_check(mod[[1]], ndraws = 100))
```

## Model 7a: Proportion invasive trees in VSMPE 
```{r, echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
mod <- prior_model_list['pi_vsmpe_prior']
figs <- plot_prior(mod[[1]], -3, 3, 'Predicted Proportion Invasive Stems')
do.call(grid.arrange, figs)
plot(pp_check(mod[[1]], ndraws = 100))
```

## Model 7b: Proportion invasive trees in TR 
```{r, echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
mod <- prior_model_list['pi_vsmpe_prior']
plot(pp_check(mod[[1]], ndraws = 100))
```