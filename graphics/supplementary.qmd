---
title: "Supplementary Information - Paper Title"
format:
  html:
    toc: true
    toc-location: right
    toc-depth: 3
---

Authors: Isabella C. Richmond^1^\*, Kayleigh Hutt-Taylor^1,2^, Lauren Bianco^1^, Antonia Vieira Zanella^3^, François Bérubé^4^, Paola Faddoul^4^, Kelly Vu^4^, Étienne Perreault-Mandeville^5^, Patrick Boivin^6^, Danielle Dagenais^6^, Nathalie Boucher^5^, Thi Thanh Hiên Pham^4^, Carly D. Ziter^1^

1 Department of Biology, Concordia University, Montreal Canada, H4B 1R6

2 Tree Canada

3 Department of Geography, Federal University of Paraná, Paraná Brazil,

4 Département d'études urbaines et touristiques, Université du Québec à Montréal, Montreal Canada,

5 Organisme Respire

6 École d'urbanisme et d'architecture de paysage, Université de Montréal, Montreal Canada

\* isabella.richmond\@mail.concordia.ca

```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false
#| label: setup

source('R/packages.R')

plot_prior <- function(mod, xmin, xmax, ylab){
  
  # how to sequence data
  seq_d <- seq(xmin, xmax, by = 0.25)
  
  # pull variables from model 
  vars <- colnames(mod$data)[-1]
  
  # identify categorical variables 
  factors <- names(Filter(is.character ,mod$data[-1]))
  # remove any that are random effects 
  factors <- factors[! factors %in% mod$ranef$group]
  
  # identify numeric variables 
  numeric <- names(Filter(is.numeric,mod$data[-1]))
  numeric <- subset(numeric, numeric != "total_trees" & numeric != "n")
  
  figlist <- lapply(numeric, function(x){
    
    df <- data.frame(matrix(ncol=length(vars),nrow=0, dimnames=list(NULL, vars)))
    
    df %<>%
      summarise_at(x, ~seq_d) %>% 
      bind_rows(df, .) %>% 
      mutate(across(all_of(factors), as.factor)) %>% 
      mutate(across(all_of(numeric), ~ replace(., is.na(.), 0))) %>%
      distinct() %>%
      mutate(total_trees = 85,
             n = 85)
    
    epred <- add_epred_draws(df, mod)
    
    ggplot(epred, aes(x = get(x), y = .epred)) +
      geom_line(aes(group = .draw), alpha = 0.1) +
      labs(y = ylab, x = x) +
      theme_classic()
    
  })
  
  # make data grid appropriate for each model
  if (length(factors) == 1) {
    md <- data_grid(mod$data, 
                    type,
                    .model = mod)
  } else {
    md <- data_grid(mod$data, 
                    type,
                    tod,
                    .model = mod)
  }
  
  
  cat_figlist <- lapply(factors, function(x){
    
    
    df <- data.frame(matrix(ncol=length(numeric),nrow= nrow(md), dimnames=list(NULL, numeric))) %>% 
      cbind(., md) %>% 
      mutate(across(all_of(numeric), ~ replace(., is.na(.), 0)),
             total_trees = 50,
             n = 50) %>% 
      add_epred_draws(mod, re_formula = NA)  %>% 
      ggplot(aes(x = .epred, y = get(x))) +
      geom_jitter(alpha = 0.2, colour = 'darkgrey') +
      geom_boxplot(outlier.shape = NA, alpha = 0, linewidth = 1) +
      coord_flip() + 
      labs(x = ylab, y = "") + 
      theme_classic()
    
  
  })
  
  list <- c(figlist, cat_figlist)
  
}


plot_model_1 <- function(model){
    
    # basic model fit plots
    b <- mcmc_trace(model, pars = vars(starts_with('b_'), Intercept, any_of('sigma'), any_of(c(starts_with('sd_')))))
  
    # Gelman plot
    ac <- as_draws_df(model) %>% 
      mutate(chain = .chain) %>% 
      mcmc_acf(pars = vars(b_Intercept), lags = 35)
    
    b / ac + 
      plot_layout(ncol = 1, heights = c(3,1)) 
}

plot_model_2 <- function(model){
    # rhat values
    rhats <- brms::rhat(model)
    rh <- mcmc_rhat(rhats)
    
    # neff 
    ratios_cp <- neff_ratio(model)
    neff <- mcmc_neff(ratios_cp, size = 2)
    
    # posterior check
    pp <- pp_check(model, ndraws = 100)
    
    
    rh / neff / pp + 
      plot_layout(ncol = 1) 


  }


```




## Tables 

Table S1. Site characteristics. Infrastructure ID is the unique ID assigned to each individual site, where CON indicates a grey alley, RV indicates a green alley, and SS indicates a street segment. Parallel street names one of the parallel streets to each alley, and for street segments it indicates the street segment that was sampled for each alley. City is where the sampling occurred, VSMPE = Villeray-Saint Michel-Parc Extension and TR = Trois-Rivières. Infrastructure type indicates the site type, with three potential options, green alley, grey alley, and street segment. Percent canopy indicates the percent canopy of the site in decimal form. Firefly presence is a binomial variable, where 1 indicates that fireflies were found, 0 indicates no fireflies were found, and a blank indicates that the site was not sampled for fireflies. Number of points is the number of points where vegetative complexity was sampled (i.e., number of 10 m intervals).

```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false
#| label: table-s1

tar_load(ecological_benefits)

strts <- read.csv('input/parallel-streets.csv', encoding = 'UTF-8') %>% 
  mutate(street_segments = str_replace_all(InfrastructureID, c('CON-TR' = 'CON-SS-TR', 'CON-VSMPE' = 'CON-SS-VSMPE', 'RV-TR' ='RV-SS-TR', 'RV-VSMPE' = 'SS-VSMPE'))) %>% 
  pivot_longer(cols = c(InfrastructureID, street_segments), values_to = 'InfrastructureID') %>% 
  select(-name)



ecological_benefits %>% 
  inner_join(., strts) %>%
  select(c(InfrastructureID, parallel_street, city, type, per_can, firefly_presence, npoints)) %>% 
  mutate(type = case_when(type == 'Segments des Rues' ~ 'street segment',
                          type == 'Ruelles Vertes' ~ 'green alley',
                          type == 'Ruelles Traditionelles' ~ 'grey alley'),
         city = case_when(city == 'Villeray-Saint Michel-Parc Extension' ~ 'VSMPE',
                          city == 'Trois-Rivières' ~ 'TR')) %>% 
  st_drop_geometry() %>% 
  flextable() %>% 
  set_header_labels(
    InfrastructureID = "Infrastructure ID",
    parallel_street = "Parallel Street",
    city = "City",
    type = "Infrastructure Type",
    per_can = "Percent Canopy",
    firefly_presence = "Firefly Presence",
    npoints = "Number of Points"
  ) %>% 
  colformat_double(j = 'per_can', digits=2) %>% 
  set_table_properties(
  opts_html = list(
    scroll = list(
      height = "500px",
      freeze_first_column = TRUE
    )
  )
)


```



Table S2. Tree species characteristics for species found in this study. Species represents binomial nomenclature for the species, max height represents the maximum height (in metres) for the species, flowers indicate if the species has showy or non-showy flowers when in bloom, native is a binomial category that indicates if the species is native to the St Lawrence Lowlands ecoregion (1 = yes, 0 = no), invasive is a binomial category that indicates if the species is invasive to the region (1 = yes, 0 = no), functional group represents the functional group assigned by Paquette et al. for that species (Paquette et al., 2021, Praise for diversity: A functional approach to reduce risks in urban forests). Blank cells indicate that we could not find the information for that species. 

```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false
#| label: table-s2

tar_load(tree_traits)

tree_traits %>% 
  select(-c(X,Native_ETF)) %>% 
  flextable() %>% 
  set_header_labels(
    latin.name = "Species",
    maximum.height = "Max Height (m)",
    flowering = "Flowers",
    native_SLL = "Native",
    Invasive = "Invasive",
    FunctionalGroup = "Functional Group"
  ) %>% 
  set_table_properties(
  opts_html = list(
    scroll = list(
      height = "500px",
      freeze_first_column = TRUE
    )))



```




Table S3. Data showing the number of mentions that each ecosystem service category received in the interviews. Total mentions refers to the total number of times an ecosystem service was mentioned, regardless of if the same person brought it up multiple times. Number of people mentioned refers to the total number of people who mentioned that ecosystem service, without incorporating how many times they mentioned it. A darker colour depicts a higher number of mentions. 

```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false
#| label: table-s3

tar_load(interviews)

t <- col_bin("Greens", domain = 0:75)

interviews %>% 
  flextable() %>% 
  bg(
    j = c("TotalMentions", "TotalPeopleMentions"),
    bg = t, part = "body"
  ) %>% 
  set_header_labels(
    EcosystemService = "Ecosystem Service",
    TotalMentions = "Total Mentions",
    TotalPeopleMentions = "Number of People Mentioned"
  ) %>%
  set_table_properties(
    opts_html = list(
      scroll = list(
      height = "500px",
      freeze_first_column = TRUE))
  )



```


## Figures 


![](mtl_dags_eb.png)
Figure S1a. DAGs that indicate the system assumptions for ecological benefits measured in this study. Blue indicates the response variable of interest, green indicates the variable of interest and all variables adjusted for. 

![](mtl_dags_es.png)
Figure S1b. DAGs that indicate the system assumptions for ecosystem services measured in this study. Blue indicates the response variable of interest, green indicates the variable of interest and all variables adjusted for. 




# Prior Predictive Checks 

Prior predictive checks are used to ensure that the values selected for priors for our models allow a biologically reasonable range of values. For numeric predictor variables, we simulate predictive draws for prior only models and visualize the slope/intercept of the values. We then do a "posterior predictive check" but with the prior only model, to see if the data is captured in the priors. Note that all data is scaled and centered in these data.

For Trois-Rivieres, there is only a categorical predictor variable. Therefore, only the posterior predictive check is presented.

```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false
#| label: prior-setup


tar_load(prior_model_list)

vsmpe <- prior_model_list[grepl("vsmpe", names(prior_model_list))] %>% 
  setNames(., c('Canopy Cover', 'Firefly Abundance', 'Species Richness', 'Functional Diversity', 
                'Vertical Complexity', 'Percent Native', 'Percent Invasive', 'Temperature', 
                'Tree Abundance', 'Tree Size (DBH)', 'Tree Height', 'Percent Flowery'))
tr <- prior_model_list[grepl("tr", names(prior_model_list))] %>% 
  setNames(., c('Canopy Cover', 'Species Richness', 'Functional Diversity', 'Vertical Complexity', 
                'Percent Native', 'Percent Invasive', 'Temperature', 
                'Tree Abundance', 'Tree Size (DBH)', 'Tree Height', 'Percent Flowery'))

```


## Villeray-Saint Michel-Parc Extension
```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false
#| column: screen
#| out-width: 100%
#| label: prior-plots-vsmpe


invisible(capture.output(lapply(seq_along(vsmpe), function(x){
  
  figs <- plot_prior(vsmpe[[x]], -2, 2, paste(names(vsmpe[x])))
  
  wrap_plots(figs, nrow = 3, ncol = 2) + 
    plot_annotation(title = print(names(vsmpe[x])))
  
})))
```

## Trois-Rivieres
```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false
#| column: screen
#| out-width: 100%
#| label: prior-plots-tr


invisible(capture.output(lapply(seq_along(tr), function(x){
  
  figs <- plot_prior(tr[[x]], -2, 2, paste(names(tr[x])))
  
  wrap_plots(figs, nrow = 1, ncol = 2) + 
    plot_annotation(title = print(names(tr[x])))
  
})))

```


# Model Diagnostics 

These model diagnostic plots assess whether the chains of our models are converged and well mixed, and if the model is well specified and has an adequate fit.

The first plot of the series shows trace plots for each of our parameters, where we want to see stationary and well-mixed chains. The second plot shows an autocorrelation plot by chain and parameter. We want our autocorrelation to quickly drop to zero with increasing lag. Thirdly, the Rhat plot monitors whether a chain has converged to the equilibrium distribution, if all chains are at equilibrium Rhat will be one. If chains have not converged, Rhat will be greater than 1. The fourth plot is the ratio between effective sample size (Neff) and total sample size (N).Because the draws within a Markov chain are not independent if there is autocorrelation, the effective sample size, neff, is usually smaller than the total sample size, N. The larger the ratio, the better. Finally, we have the posterior predictive check where we want the black line to be within/close to the blue lines, to indicate that our model is adequately generative.


```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false
#| label: diagnostics-setup


tar_load(model_list)

vsmpe <- model_list[grepl("vsmpe", names(model_list))] %>% 
  setNames(., c('Canopy Cover', 'Firefly Abundance', 'Species Richness', 'Functional Diversity', 
                'Vertical Complexity', 'Percent Native', 'Percent Invasive', 'Temperature', 
                'Tree Abundance', 'Tree Size (DBH)', 'Tree Height', 'Percent Flowery'))

tr <- model_list[grepl("tr", names(model_list))] %>% 
  setNames(., c('Canopy Cover', 'Species Richness', 'Functional Diversity', 'Vertical Complexity', 
                'Percent Native', 'Percent Invasive', 'Temperature', 
                'Tree Abundance', 'Tree Size (DBH)', 'Tree Height', 'Percent Flowery'))


```



## Villeray-Saint Michel-Parc Extension
```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false
#| column: screen
#| fig-width: 20
#| fig-height: 20
#| label: diagnostic-plots-vsmpe


invisible(capture.output(lapply(seq_along(vsmpe), function(x){
  
  p1 <- plot_model_1(vsmpe[[x]]) 
  
  p2 <- plot_model_2(vsmpe[[x]])
  
  wrap_plots(p1, p2, ncol = 1) + plot_annotation(title = print(names(vsmpe[x])), theme = theme(plot.title = element_text(size = 16)))
  
})))





```

## Trois-Rivieres
```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false
#| column: screen
#| fig-height: 20
#| fig-width: 20
#| label: diagnostic-plots-tr

invisible(capture.output(lapply(seq_along(tr), function(x){
  
  p1 <- plot_model_1(tr[[x]]) 
  
  p2 <- plot_model_2(tr[[x]])
  
  wrap_plots(p1, p2, ncol = 1) + plot_annotation(title = print(names(tr[x])), theme = theme(plot.title = element_text(size = 16)))
  
})))


```


## Equations 

Below are the mathstats formulas for each of the models included in the paper. 

### Canopy Cover 

1. VSMPE 
$$
Canopy_i \sim Normal(\mu_i, \sigma)
\\
\mu_i = \alpha_{Q socio[i]} + \beta_{type[i]} + \beta_{med inc}med inc_i + \beta_{french}french_i + \beta_{english}english_i + \beta_{none}none_i
\\
\beta_j \sim Normal(0, 0.3)
\\
\alpha_j \sim Normal(\bar{\alpha}, \sigma_\alpha)
\\
\bar\alpha \sim Normal(0, 0.5)
\\
\sigma_\alpha \sim Half-Normal(0, 0.2)
\\
\sigma \sim Exponential(1)
$$
Terms: 
-   `Canopy` is the centered and scaled percent canopy cover of each site
-   `type` is the type of infrastructure (i.e., green alley, grey alley, street segment)
-   `medinc` is the centered and scaled median income of the dissemination area surrounding the site
-   `french` is the centered and scaled percent of residents in the dissemination area surrounding the site that speak french 
-   `english` is the centered and scaled percent of residents in the dissemination area surrounding the site that speak english 
-   `none` is the centered and scaled percent of residents in the dissemination area surrounding the site that do not speak french or english


2. TR

$$
Canopy \sim Normal(\mu_i, \sigma)
\\
\mu_i = \alpha + \beta_1 green_{[i]} + \beta_2street_{[i]}
\\
\alpha \sim Normal(0, 0.7)
\\
\beta_j \sim Normal(0, 0.7)
\\
\sigma \sim Exponential(1)
$$
Terms: 
-   `Canopy` is the centered and scaled percent canopy cover of each site
-   `green` is the factor level from `type` that indicates green alleys. Grey alleys are the default level, absorbed into the intercept. 
-   `street` is the factor level from `type` that indicates street segments. Grey alleys are the default level, absorbed into the intercept.

### Species Richness 

3. VSMPE 

$$
Species Richness_i \sim Gamma-Poisson(\lambda_i, \phi)
\\
log(\lambda_i) = \alpha_{Q socio[i]} + \beta_{type[i]} + \beta_{med inc}med inc_i + \beta_{french}french_i + \beta_{english}english_i + \beta_{none}none_i
\\
\beta_j \sim Normal(0, 0.2)
\\
\alpha_j \sim Normal(\bar{\alpha}, \sigma_\alpha)
\\
\bar\alpha \sim Normal(0, 0.5)
\\
\sigma_\alpha \sim Half-Normal(0, 0.1)
\\
\phi \sim Inverse-Gamma(0.4,0.3)
$$

Terms: 
-   `Species Richness` is number of unique tree species found at each site 
-   `Q socio` is the neighbourhood of the site (i.e., Villeray, Saint-Michel, or Parc Extension)
-   `type` is the type of infrastructure (i.e., green alley, grey alley, or street segment)
-   `medinc` is the centered and scaled median income of the dissemination area surrounding the site
-   `french` is the centered and scaled percent of residents in the dissemination area surrounding the site that speak french 
-   `english` is the centered and scaled percent of residents in the dissemination area surrounding the site that speak english 
-   `none` is the centered and scaled percent of residents in the dissemination area surrounding the site that do not speak french or english



4. TR
$$
Species Richness_i \sim Poisson(\lambda_i)
\\
log(\lambda_i) = \alpha + \beta_1 green_{[i]} + \beta_2street_{[i]}
\\
\alpha \sim Normal(0, 0.5)
\\
\beta_j \sim Normal(0, 0.2)

$$
Terms: 
-   `Species Richness` is number of unique tree species found at each site 
-   `green` is the factor level from `type` that indicates green alleys. Grey alleys are the default level, absorbed into the intercept. 
-   `street` is the factor level from `type` that indicates street segments. Grey alleys are the default level, absorbed into the intercept.


### Functional Diversity 

5. VSMPE


$$
Functional Groups_i \sim Binomial(9, p_i)
\\
logit(p_i) = \alpha_{Q socio[i]} + \beta_{type[i]} + \beta_{med inc}med inc_i + \beta_{french}french_i + \beta_{english}english_i + \beta_{none}none_i
\\
\beta_j \sim Normal(0, 0.2)
\\
\alpha_j \sim Normal(\bar{\alpha}, \sigma_\alpha)
\\
\bar\alpha \sim Normal(0, 0.5)
\\
\sigma_\alpha \sim Half-Normal(0, 0.1)

$$


Terms: 
-   `Functional Groups` is number of unique functional groups found at each site (the maximum number possible is 9)
-   `Q socio` is the neighbourhood of the site (i.e., Villeray, Saint-Michel, or Parc Extension)
-   `type` is the type of infrastructure (i.e., green alley, grey alley, or street segment)
-   `medinc` is the centered and scaled median income of the dissemination area surrounding the site
-   `french` is the centered and scaled percent of residents in the dissemination area surrounding the site that speak french 
-   `english` is the centered and scaled percent of residents in the dissemination area surrounding the site that speak english 
-   `none` is the centered and scaled percent of residents in the dissemination area surrounding the site that do not speak french or english



6. TR
$$
Functional Groups_i \sim Binomial(9, p_i)
\\
logit(p_i) = \alpha + \beta_1 green_{[i]} + \beta_2street_{[i]}
\\
\alpha \sim Normal(0, 0.5)
\\
\beta_j \sim Normal(0, 0.2)

$$
Terms: 
-   `Functional Groups` is number of unique functional groups found at each site (the maximum number possible is 9)
-   `green` is the factor level from `type` that indicates green alleys. Grey alleys are the default level, absorbed into the intercept. 
-   `street` is the factor level from `type` that indicates street segments. Grey alleys are the default level, absorbed into the intercept.


### Proportion of Native Species 

7. VSMPE

$$
Proportion Native_i \sim Binomial(N_i, p_i)
\\
logit(p_i) = \alpha_{Q socio[i]} + \beta_{type[i]} + \beta_{med inc}med inc_i + \beta_{french}french_i + \beta_{english}english_i + \beta_{none}none_i
\\
\beta_j \sim Normal(0, 0.5)
\\
\alpha_j \sim Normal(\bar{\alpha}, \sigma_\alpha)
\\
\bar\alpha \sim Normal(0, 1.5)
\\
\sigma_\alpha \sim Half-Normal(0, 0.2)

$$
Terms: 
-   `N` is the total number of trees found at each site
-   `Proportion Native` is number of native trees found at each site
-   `Q socio` is the neighbourhood of the site (i.e., Villeray, Saint-Michel, or Parc Extension)
-   `type` is the type of infrastructure (i.e., green alley, grey alley, or street segment)
-   `medinc` is the centered and scaled median income of the dissemination area surrounding the site
-   `french` is the centered and scaled percent of residents in the dissemination area surrounding the site that speak french 
-   `english` is the centered and scaled percent of residents in the dissemination area surrounding the site that speak english 
-   `none` is the centered and scaled percent of residents in the dissemination area surrounding the site that do not speak french or english




8. TR
$$
Proportion Native_i \sim Binomial(N_i, p_i)
\\
logit(p_i) = \alpha + \beta_1 green_{[i]} + \beta_2street_{[i]}
\\
\alpha \sim Normal(0, 1.5)
\\
\beta_j \sim Normal(0, 0.5)
$$
-   `N` is the total number of trees found at each site
-   `Proportion Native` is number of native trees found at each site
-   `green` is the factor level from `type` that indicates green alleys. Grey alleys are the default level, absorbed into the intercept. 
-   `street` is the factor level from `type` that indicates street segments. Grey alleys are the default level, absorbed into the intercept.

### Proportion of Invasive Species 

9. VSMPE

$$
Proportion Invasive_i \sim Binomial(N_i, p_i)
\\
logit(p_i) = \alpha_{Q socio[i]} + \beta_{type[i]} + \beta_{med inc}med inc_i + \beta_{french}french_i + \beta_{english}english_i + \beta_{none}none_i
\\
\beta_j \sim Normal(0, 0.5)
\\
\alpha_j \sim Normal(\bar{\alpha}, \sigma_\alpha)
\\
\bar\alpha \sim Normal(-1.4, 0.5)
\\
\sigma_\alpha \sim Half-Normal(0, 0.2)

$$
Terms: 
-   `N` is the total number of trees found at each site
-   `Proportion Invasive` is number of invasive trees found at each site
-   `Q socio` is the neighbourhood of the site (i.e., Villeray, Saint-Michel, or Parc Extension)
-   `type` is the type of infrastructure (i.e., green alley, grey alley, or street segment)
-   `medinc` is the centered and scaled median income of the dissemination area surrounding the site
-   `french` is the centered and scaled percent of residents in the dissemination area surrounding the site that speak french 
-   `english` is the centered and scaled percent of residents in the dissemination area surrounding the site that speak english 
-   `none` is the centered and scaled percent of residents in the dissemination area surrounding the site that do not speak french or english


10. TR

$$
Proportion Invasive_i \sim Binomial(N_i, p_i)
\\
logit(p_i) = \alpha + \beta_1 green_{[i]} + \beta_2street_{[i]}
\\
\alpha \sim Normal(0, 1.5)
\\
\beta_j \sim Normal(0, 0.5)
$$
-   `N` is the total number of trees found at each site
-   `Proportion Invasive` is number of invasive trees found at each site
-   `green` is the factor level from `type` that indicates green alleys. Grey alleys are the default level, absorbed into the intercept. 
-   `street` is the factor level from `type` that indicates street segments. Grey alleys are the default level, absorbed into the intercept.

### Vegetative Complexity 

11. VSMPE 

$$
Complexity_i \sim Normal(\mu_i, \sigma)
\\
\mu_i = \alpha_{Q socio[i]} + \beta_{type[i]} + \beta_{med inc}med inc_i + \beta_{french}french_i + \beta_{english}english_i + \beta_{none}none_i
\\
\beta_j \sim Normal(0, 0.5)
\\
\alpha_j \sim Normal(\bar{\alpha}, \sigma_\alpha)
\\
\bar\alpha \sim Normal(0, 0.5)
\\
\sigma_\alpha \sim Half-Normal(0, 0.2)
\\
\sigma \sim Exponential(1)
$$
Terms: 
-   `Complexity` is the centered and scaled average vegetative complexity of each site
-   `type` is the type of infrastructure (i.e., green alley, grey alley, street segment)
-   `medinc` is the centered and scaled median income of the dissemination area surrounding the site
-   `french` is the centered and scaled percent of residents in the dissemination area surrounding the site that speak french 
-   `english` is the centered and scaled percent of residents in the dissemination area surrounding the site that speak english 
-   `none` is the centered and scaled percent of residents in the dissemination area surrounding the site that do not speak french or english



12. TR

$$
Complexity_i \sim Normal(\mu_i, \sigma)
\\
\mu_i = \alpha + \beta_1 green_{[i]} + \beta_2street_{[i]}
\\
\alpha \sim Normal(0, 0.5)
\\
\beta_j \sim Normal(0, 0.5)
$$
-   `Complexity` is the centered and scaled average vegetative complexity of each site
-   `green` is the factor level from `type` that indicates green alleys. Grey alleys are the default level, absorbed into the intercept. 
-   `street` is the factor level from `type` that indicates street segments. Grey alleys are the default level, absorbed into the intercept.

### Firefly Presence

13. VSMPE 

$$
Firefly Presence_i \sim Bernoulli(p_i)
\\
logit(p_i) = \alpha_{Q socio[i]} + \beta_{type[i]} + \beta_{med inc}med inc_i + \beta_{french}french_i + \beta_{english}english_i + \beta_{none}none_i
\\
\beta_j \sim Normal(0, 0.5)
\\
\alpha_j \sim Normal(\bar{\alpha}, \sigma_\alpha)
\\
\bar\alpha \sim Normal(-1.4, 0.5)
\\
\sigma_\alpha \sim Half-Normal(0, 0.2)

$$
Terms: 
-   `Firefly Presence` is binary success of observing a firefly at a site (1 = presence, 0 = absence)
-   `Q socio` is the neighbourhood of the site (i.e., Villeray, Saint-Michel, or Parc Extension)
-   `type` is the type of infrastructure (i.e., green alley, grey alley, or street segment)
-   `medinc` is the centered and scaled median income of the dissemination area surrounding the site
-   `french` is the centered and scaled percent of residents in the dissemination area surrounding the site that speak french 
-   `english` is the centered and scaled percent of residents in the dissemination area surrounding the site that speak english 
-   `none` is the centered and scaled percent of residents in the dissemination area surrounding the site that do not speak french or english



### Temperature 

14. VSMPE

$$
Temperature_i \sim Normal(\mu_i, \sigma)
\\
\mu_i = \alpha_{date[i]} + \alpha_{Q socio[i]} + \alpha_{ID[i]} + \gamma_{type[i]} +  \gamma_{tod[i]} + \gamma_{doy[i]} + \\
\beta_{type}tod + \beta_{tod}doy + \beta_{doy}type  + \beta_{type[i]} + \beta_{tod[i]} + \beta_{doy}doy_i + \\
\beta_{med inc}med inc_i + \beta_{french}french_i + \beta_{english}english_i + \beta_{none}none_i
\\
\alpha_{date[j]} \sim Normal(\bar\alpha, \sigma_{\alpha_{date}})
\\
\alpha_{Q socio[j]} \sim Normal(0, \sigma_{\alpha_{Q socio}})
\\
\alpha_{ID[j]} \sim Normal(0, \sigma_{\alpha_{ID}})
\\
\gamma_j \sim Normal(0, 1)
\\
\beta_j \sim Normal(0, 0.5)
\\
\bar\alpha \sim Normal(0, 1)
\\
\sigma_{\alpha_{date}} \sim Exponential(1)
\\
\sigma_{\alpha_{Q socio}} \sim Exponential(1)
\\
\sigma_{\alpha_{ID}} \sim Exponential(1)
\\
\sigma \sim Exponential(1)

$$
Terms: 
-   $\alpha$ and $\gamma$ both represent intercepts, $\alpha$ is used for random effects and $\gamma$ for fixed interaction effecst 
-   `Temperature` is the centered and scaled temperature measurement in degrees Celsius
-   `date` is the calendar date represented as a character with a different level for each day
-   `Q socio` is the neighbourhood of the site (i.e., Villeray, Saint-Michel, or Parc Extension)
-   `ID` is the individual identifier for each infrastructure (e.g., )
-   `type` is the type of infrastructure (i.e., green alley, grey alley, or street segment)
-   `tod` is the time of day of each measurement, split into two categories; day (after sunrise/before sunset) and night (after sunset/before sunrise)
-   `doy` is the numeric and continuous value representing day of year, which has been subtracted by the first day of sampling so that it starts at 0
-   `medinc` is the centered and scaled median income of the dissemination area surrounding the site
-   `french` is the centered and scaled percent of residents in the dissemination area surrounding the site that speak french 
-   `english` is the centered and scaled percent of residents in the dissemination area surrounding the site that speak english 
-   `none` is the centered and scaled percent of residents in the dissemination area surrounding the site that do not speak french or english


15. TR

$$
Temperature_i \sim Normal(\mu_i, \sigma)
\\
\mu_i = \alpha_{date[i]} + \alpha_{ID[i]} + \gamma_{type[i]} +  \gamma_{tod[i]} + \gamma_{doy[i]} + \\
\beta_{type}tod + \beta_{tod}doy + \beta_{doy}type  + \beta_{type[i]} + \beta_{tod[i]} + \beta_{doy}doy_i 
\\
\alpha_{date[j]} \sim Normal(\bar\alpha, \sigma_{\alpha_{date}})
\\
\alpha_{Q socio[j]} \sim Normal(0, \sigma_{\alpha_{Q socio}})
\\
\alpha_{ID[j]} \sim Normal(0, \sigma_{\alpha_{ID}})
\\
\gamma_j \sim Normal(0, 1)
\\
\beta_j \sim Normal(0, 0.5)
\\
\bar\alpha \sim Normal(0, 1)
\\
\sigma_{\alpha_{date}} \sim Exponential(1)
\\
\sigma_{\alpha_{Q socio}} \sim Exponential(1)
\\
\sigma_{\alpha_{ID}} \sim Exponential(1)
\\
\sigma \sim Exponential(1)

$$

Terms: 
-   $\alpha$ and $\gamma$ both represent intercepts, $\alpha$ is used for random effects and $\gamma$ for fixed interaction effecst 
-   `Temperature` is the centered and scaled temperature measurement in degrees Celsius
-   `date` is the calendar date represented as a character with a different level for each day
-   `ID` is the individual identifier for each infrastructure (e.g., )
-   `type` is the type of infrastructure (i.e., green alley, grey alley, or street segment)
-   `tod` is the time of day of each measurement, split into two categories; day (after sunrise/before sunset) and night (after sunset/before sunrise)
-   `doy` is the numeric and continuous value representing day of year, which has been subtracted by the first day of sampling so that it starts at 0


### Tree Abundance

16. VSMPE

$$
Tree Abundance_i \sim Gamma-Poisson(\lambda_i, \phi)
\\
log(\lambda_i) = \alpha_{Q socio[i]} + \beta_{type[i]} + \beta_{med inc}med inc_i + \beta_{french}french_i + \beta_{english}english_i + \beta_{none}none_i
\\
\beta_j \sim Normal(0, 0.2)
\\
\alpha_j \sim Normal(\bar{\alpha}, \sigma_\alpha)
\\
\bar\alpha \sim Normal(0, 0.5)
\\
\sigma_\alpha \sim Half-Normal(0, 0.1)
\\
\phi \sim Inverse-Gamma(0.4,0.3)
$$

Terms: 
-   `Tree Abundance` is number of individual trees found at a site
-   `Q socio` is the neighbourhood of the site (i.e., Villeray, Saint-Michel, or Parc Extension)
-   `type` is the type of infrastructure (i.e., green alley, grey alley, or street segment)
-   `medinc` is the centered and scaled median income of the dissemination area surrounding the site
-   `french` is the centered and scaled percent of residents in the dissemination area surrounding the site that speak french 
-   `english` is the centered and scaled percent of residents in the dissemination area surrounding the site that speak english 
-   `none` is the centered and scaled percent of residents in the dissemination area surrounding the site that do not speak french or english



17. TR
$$
Tree Abundance_i \sim Poisson(\lambda_i)
\\
log(\lambda_i) = \alpha + \beta_1 green_{[i]} + \beta_2street_{[i]}
\\
\alpha \sim Normal(0, 0.5)
\\
\beta_j \sim Normal(0, 0.2)

$$
-   `Tree Abundance` is number of individual trees found at a site
-   `green` is the factor level from `type` that indicates green alleys. Grey alleys are the default level, absorbed into the intercept. 
-   `street` is the factor level from `type` that indicates street segments. Grey alleys are the default level, absorbed into the intercept.

### Tree Size (Diameter at Breast Height)


18. VSMPE

$$
DBH_i \sim Normal(\mu_i, \sigma)
\\
\mu_i = \alpha_{Q socio[i]} + \beta_{type[i]} + \beta_{med inc}med inc_i + \beta_{french}french_i + \beta_{english}english_i + \beta_{none}none_i
\\
\beta_j \sim Normal(0, 0.3)
\\
\alpha_j \sim Normal(\bar{\alpha}, \sigma_\alpha)
\\
\bar\alpha \sim Normal(0, 0.5)
\\
\sigma_\alpha \sim Half-Normal(0, 0.2)
\\
\sigma \sim Exponential(1)
$$
Terms: 
-   `DBH` is the centered and scaled mean diameter at breast height (DBH) of trees at each site
-   `type` is the type of infrastructure (i.e., green alley, grey alley, street segment)
-   `medinc` is the centered and scaled median income of the dissemination area surrounding the site
-   `french` is the centered and scaled percent of residents in the dissemination area surrounding the site that speak french 
-   `english` is the centered and scaled percent of residents in the dissemination area surrounding the site that speak english 
-   `none` is the centered and scaled percent of residents in the dissemination area surrounding the site that do not speak french or english



19. TR
$$
DBH_i \sim Normal(\mu_i, \sigma)
\\
\mu_i = \alpha + \beta_1 green_{[i]} + \beta_2street_{[i]}
\\
\alpha \sim Normal(0, 0.7)
\\
\beta_j \sim Normal(0, 0.7)
\\
\sigma \sim Exponential(1)
$$
-   `DBH` is the centered and scaled mean diameter at breast height (DBH) of trees at each site
-   `green` is the factor level from `type` that indicates green alleys. Grey alleys are the default level, absorbed into the intercept. 
-   `street` is the factor level from `type` that indicates street segments. Grey alleys are the default level, absorbed into the intercept.

### Tree Size (Potential Maximum Height)

20. VSMPE

$$
Max Height_i \sim Normal(\mu_i, \sigma)
\\
\mu_i = \alpha_{Q socio[i]} + \beta_{type[i]} + \beta_{med inc}med inc_i + \beta_{french}french_i + \beta_{english}english_i + \beta_{none}none_i
\\
\beta_j \sim Normal(0, 0.3)
\\
\alpha_j \sim Normal(\bar{\alpha}, \sigma_\alpha)
\\
\bar\alpha \sim Normal(0, 0.5)
\\
\sigma_\alpha \sim Half-Normal(0, 0.2)
\\
\sigma \sim Exponential(1)
$$
Terms: 
-   `Max Height` is the centered and scaled mean maximum (potential) height of trees at each site
-   `type` is the type of infrastructure (i.e., green alley, grey alley, street segment)
-   `medinc` is the centered and scaled median income of the dissemination area surrounding the site
-   `french` is the centered and scaled percent of residents in the dissemination area surrounding the site that speak french 
-   `english` is the centered and scaled percent of residents in the dissemination area surrounding the site that speak english 
-   `none` is the centered and scaled percent of residents in the dissemination area surrounding the site that do not speak french or english


21. TR

$$
Max Height_i \sim Normal(\mu_i, \sigma)
\\
\mu_i = \alpha + \beta_1 green_{[i]} + \beta_2street_{[i]}
\\
\alpha \sim Normal(0, 0.7)
\\
\beta_j \sim Normal(0, 0.7)
\\
\sigma \sim Exponential(1)
$$
-   `Max Height` is the centered and scaled mean maximum (potential) height of trees at each site
-   `green` is the factor level from `type` that indicates green alleys. Grey alleys are the default level, absorbed into the intercept. 
-   `street` is the factor level from `type` that indicates street segments. Grey alleys are the default level, absorbed into the intercept.


### Proportion of Trees with Showy Flowers 

22. VSMPE
$$
Proportion Showy_i \sim Binomial(N_i, p_i)
\\
logit(p_i) = \alpha_{Q socio[i]} + \beta_{type[i]} + \beta_{med inc}med inc_i + \beta_{french}french_i + \beta_{english}english_i + \beta_{none}none_i
\\
\beta_j \sim Normal(0, 0.5)
\\
\alpha_j \sim Normal(\bar{\alpha}, \sigma_\alpha)
\\
\bar\alpha \sim Normal(0, 0.5)
\\
\sigma_\alpha \sim Half-Normal(0, 0.2)

$$
Terms: 
-   `N` is the total number of trees found at each site
-   `Proportion Showy` is number of trees with showy flowers found at each site
-   `Q socio` is the neighbourhood of the site (i.e., Villeray, Saint-Michel, or Parc Extension)
-   `type` is the type of infrastructure (i.e., green alley, grey alley, or street segment)
-   `medinc` is the centered and scaled median income of the dissemination area surrounding the site
-   `french` is the centered and scaled percent of residents in the dissemination area surrounding the site that speak french 
-   `english` is the centered and scaled percent of residents in the dissemination area surrounding the site that speak english 
-   `none` is the centered and scaled percent of residents in the dissemination area surrounding the site that do not speak french or english


23. TR
$$
Proportion Showy_i \sim Binomial(N_i, p_i)
\\
logit(p_i) = \alpha + \beta_1 green_{[i]} + \beta_2street_{[i]}
\\
\alpha \sim Normal(0, 0.5)
\\
\beta_j \sim Normal(0, 0.5)
$$

-   `N` is the total number of trees found at each site
-   `Proportion Showy` is number of trees with showy flowers found at each site
-   `green` is the factor level from `type` that indicates green alleys. Grey alleys are the default level, absorbed into the intercept. 
-   `street` is the factor level from `type` that indicates street segments. Grey alleys are the default level, absorbed into the intercept.


## Methodological Details 

### Canopy Cover 
We calculated percent canopy cover of all green alleys, grey alleys, and street segments using publicly available LiDAR data collected in 2020 at a spatial resolution of 1 m (Institut National de Santé Publique du Québec and Gouvernement du Québec, 2022). For street segments, we calculated the canopy cover of sidewalks using the same dataset. Sidewalk boundaries were extracted from an open dataset for VSMPE (Ville de Montréal, 2024) and hand-drawn for TR using QGIS 3.16.8 (QGIS Development Team, 2020).

### Tree Diversity
Tree diversity was assessed in two ways. First, we calculated the species richness of each alley and street segment by counting the number of unique tree species. We identified the species of each individual in the field (Farrar, 1995; Little, 1980). If a tree species could not be identified in the field, it was marked as unknown (n = 1/1,469). If a tree was dead, it was still recorded but was removed from the diversity calculations (n = 7/1,469). We recorded a total of 75 species (Table S2). 

The second diversity metric was functional diversity. Using the original dataset and methodology from Paquette et al. (2021), we assigned a functional group to each of the tree species present in our dataset (Belluau et al., 2021, Table S2). The database published online did not have a functional group assignment for 15 of our species (20%, predominantly cultivars), thus those species were removed from the functional diversity calculations. If a cultivar or hybrid was not present in the database, but both parent species were and they shared the same functional group, we assigned the functional group of the parent species to the cultivar. We then summed how many functional groups each alley or street segment contained.

### Proportion of Invasives/Natives
To assess the proportion of invasive and native species at each study site, we assigned a status of native or invasive to each of our study species (Padvaiskas et al., subm, Philp, 2024, Table S2). A species’ native range was evaluated using the St. Lawrence Lowlands ecoregion. The St. Lawrence Lowlands ecoregion surrounds the St. Lawrence River ranging from Quebec City south through Montreal and just beyond Ottawa (Minister of Industry, 2010). If the native range of a species fell within a region we deemed it native to that region (Canadian Wildlife Federation, 2024; Dirr and Warren, 2019; Fryer, 2018; Government of Canada, 2013; The Morton Arboretum, 2022; Tree Canada, 2024; United States Department of Agriculture and Natural Resources Conservation Service, 2024; Woody Invasives of the Great Lakes Collaborative, 2019). 

We categorized invasive species based on sources within the Eastern Temperate Forest ecoregion (The Morton Arboretum, 2022; Woody Invasives of the Great Lakes Collaborative, 2019). This is a larger ecoregion which runs west to east from Ontario to Nova Scotia and north to south from Southern Canada to Florida, USA (bplant.org, 2024). Any cultivar of a parent species that was considered invasive was also recorded as invasive. Hybrids with an invasive parent were noted as invasive only if the invasive traits persisted in the hybrid (Dirr and Warren, 2019). Once each species was assigned a status, we calculated the proportion of stems at each site that were native and invasive.

### Vegetative Complexity
We measured vegetative complexity by walking through each study site and stopping every 10 m. At each stop, we assessed which of the 5 following vegetative layers were present: ground cover, herbaceous vegetation, wall vegetation, shrubs, or canopy. If the presence of one of the layers was less than 1% of the area, it was ignored (e.g., one dandelion does not indicate the presence of an herbaceous vegetation layer). We define wall vegetation as vines and crawling vegetation that live on fences or walls. Average vegetative complexity of alleys and street segments was calculated by summing the total number of layers counted and then dividing by the number of points measured.

### Firefly Presence
To assess the habitat quality of our study alleys, we selected a subset of alleys in VSMPE and performed a presence/absence survey of fireflies (Family: Lampyridae). Fireflies are known bioindicators in cities, as they require leaf litter, access to water, and low levels of light pollution (Firefly Atlas et al., 2023; Picchi et al., 2013). We selected the 28 green alleys with the highest canopy cover and most vegetative complexity for our subset, the five grey alleys with the least canopy cover and vegetative complexity as our controls, and the associated street segment for all 34 alleys surveyed. We sampled in groups of three between dusk and early nightfall, between 9:00 and 11:30 pm.  Each person surveyed a section of the alley for five minutes and watched for the presence of fireflies. When a firefly was seen, the sampler recorded its presence. After 5 minutes, each person rotated spots and repeated the survey in the next segment. We did this three times for each alley. We did not sample in the rain, when firefly flight does not occur (Firefly Atlas et al., 2023; Picchi et al., 2013). If the presence of a firefly was noted in any of the surveys, the alley was assigned as having fireflies present.

### DBH
We assessed the presence of large trees in two ways, we calculated the mean observed tree DBH and the mean potential height for each study site. To calculate mean observed DBH, we evaluated tree size by identifying and measuring the diameter at breast height (DBH) of every tree (defined as a woody plant > 2 m tall) found in the alley. If a tree had a split stem with the split above or near DBH, we measured the DBH at the narrowest part of the stem below the fork. If the split occurred below DBH but above 6” from the ground, we measured each stem individually and calculated DBH by taking the square root of the sum of all squared stem DBHs. If the split occurred below 6” from the ground, we counted the stems as separate individuals (Magarik et al., 2020). We then took the average DBH of all the trees in an alley or street segment.


## Interview Questions
**Données sociodémographiques**
-   Âge
-   Genre
-   Groupe ethnoculturel
-   Depuis quand au Québec
-   Composition du ménage
-   Enfant(s) et âge
-   Niveau éducation
-   Situation/parcours professionnel
-   Tranche de revenu annuel de ménage
-   Type de logement
-   Possède une voiture

**Le quartier**
1. Que représente le quartier pour vous ? Qu’est-ce qui le caractérise ? Qu'est-ce qui est cher pour vous dans le quartier (ou en quoi vous seriez prêt à vous investir) ? 
2. Parlez-nous à peu près des limites de votre quartier.
3. Qu'est-ce qu'on retrouve ici en termes d'aménagement vert public ?
4. D’après vous, quels sont les objectifs et les bienfaits visés de ces aménagements pour la communauté riveraine ? Sont-ils atteints? 
5. Quels sont les inconvénients de ces aménagements pour les riverain.e.s?
6. Qu’est-ce que vous aimez le plus (et le moins) à propos de ces espaces verdis ? 
7. Comment ces espaces améliorent le quartier (social, sécurité routière et urbaine, mobilité, santé) ? 
8. Selon vous, qu’est-ce que la Ville fait pour assurer la gestion et la qualité de l’aménagement ainsi que l’entretien de ces espaces ? Est-ce qu’elle en fait assez?

**Le quartier, les espaces verdis et les changements**
9. Qu’est-ce qui a changé dans votre quartier dans les dernières années (infra vertes, aménagement du territoire, démographie, composition sociale, etc.) ? (Si quelque chose, enchaîner avec a, b, c, d)
Vous souvenez-vous depuis quand a eu lieu les changements ? Qui fait ces changements et pour quelles raisons ? Y avait-il de la mobilisation citoyenne ? 
-   Qu’est ce qui a changé dans les activités depuis les changements ?
-   Comment les relations de voisinage (résidentiels, institutionnels) ont changé ? 
-   Quel lien faites-vous entre l’aménagement d’espaces verdis et les changements dans le quartier ?

**On commence la marche**
10. Parlez-nous de ce qui attire votre attention ici ? (niveau sensoriel)
11. Parlez-nous de ce que vous ressentez ici ? (niveau émotionnel)
12. Parlez-nous de ce que vous faites/feriez ici ? (niveau activité) 
13. Parlez-nous des interventions/aménagements/équipements (éléments anthropiques)?
14. Parlez-nous de la richesse, de la diversité, de la cohabitation, des conditions des espèces ?

**Avant de conclure (30 minutes avant la fin) **
15. Quel(s) espace(s) verdi(s) vous plait le plus et le moins ? Pourquoi ? 
16. Quel(s) espace(s) verdi(s) devrait être amélioré ? Pourquoi ? 
17. En comparant les espaces visités, votre perception des espaces a-t-elle changé ? 
18. Suite à la visite, qu’est-ce que vous pensez qui est différent (ou similaire) entre les espaces verdis et non-verdis ? Qu'est-ce qui est commun, partagé entre les espaces verts visités?
19. Comment ces espaces sont-ils liés aux autres espaces verts dans la ville/à la nature en ville ? Qu’est-ce qui est commun, partagé entre ces espaces verdis et ceux du reste de la ville?
20. Avez-vous d’autres commentaires à nous partager ? 

## References 